/* ==== base ==== */
*{box-sizing:border-box}
:root{
  --brand:#ff8a00;
  --brandText:#ffe7c7;
  --bg:#0b1820;
  --card:rgba(255,255,255,.07);
  --glass:rgba(255,255,255,.12);
  --text:#e8f0f6;

  --pz-topbar-h: 58px; /* spazio sopra il puzzle */
  --splash-shift: -96px;
  --splash-btn-gap: 6px;

  /* Liquid glass tokens */
  --lg-bg: rgba(255,255,255,0.16);
  --lg-bg-strong: rgba(255,255,255,0.22);
  --lg-border: rgba(255,255,255,0.28);
  --lg-inner: rgba(255,255,255,0.10);
  --lg-shadow: 0 10px 40px rgba(0,0,0,0.28);
}
body{
  margin:0;
  font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  color:var(--text);
  background:var(--bg);
}

/* ==== background ==== */
.bg{position:fixed; inset:0; z-index:-2; background-position:center; background-size:cover}
.blur{filter:blur(3px) brightness(.9) saturate(115%); z-index:-2}
.main{z-index:-3}

/* ==== splash ==== */
.splash{ position:fixed; inset:0; z-index:9999; display:grid; place-items:center; background:#000; }
.splash-img{max-width:min(80vw,480px); width:80%; height:auto}
.splash-start{ margin-top:var(--splash-btn-gap); }
.splash-tip{margin:0;color:#ddd;opacity:.9}

.hidden{display:none !important}

/* ==== UI ==== */
.hero{padding:16px 12px 8px; text-align:center; backdrop-filter:blur(6px)}
.count{opacity:.85; margin-bottom:8px}
.filters{display:flex; gap:10px; justify-content:center; flex-wrap:wrap}
.input{padding:10px 12px; border-radius:10px; border:0}
.btn{border:0; border-radius:12px; padding:10px 14px; font-weight:700; cursor:pointer}
.btn-primary{background:var(--brand); color:#fff}

.btn-puzzle{
  background: linear-gradient(180deg, #ffd86b, #ffb200);
  color:#fd0404;
  box-shadow: 0 6px 20px rgba(81, 255, 0, 0.35);
}
.btn-puzzle:hover{ filter:brightness(1.05) }

.ghost{background:transparent; color:#fff; border:1px solid #fff3; padding:9px 12px}
.actions-top{display:flex; gap:10px; justify-content:center; margin:10px auto}

/* ==== cards ==== */
.cards{max-width:980px; margin:16px auto; padding:0 12px; display:grid; gap:16px}
.card{
  background:var(--glass);
  border-radius:18px;
  padding:16px;
  box-shadow:0 12px 38px rgba(0,0,0,.18), inset 0 1px 0 rgba(255,255,255,.08);
  backdrop-filter:blur(14px) saturate(150%);
}
.card-row{display:flex; gap:12px; align-items:center; justify-content:space-between}
.cover{width:60px;height:60px;border-radius:10px;object-fit:cover;background:#111}
.title{font-weight:800; letter-spacing:.2px}
.meta{opacity:.75; margin-top:4px}
.badges{display:flex; gap:8px; align-items:center}
.badge{background:#0008; color:#fff; padding:6px 10px; border-radius:999px; font-weight:800; font-size:.9rem}
.badge.year{background:#16232b}
.actions{display:flex; gap:8px; margin-top:12px; flex-wrap:wrap}
.action{display:inline-block; border:2px solid var(--brand); color:var(--brand); background:#fff;
  padding:8px 12px; border-radius:12px; font-weight:800; text-decoration:none}
.action:hover{background:var(--brand); color:#fff}
.action.play-added{background:var(--brand); color:#fff; border-color:var(--brand)}

.footer{text-align:center; opacity:.5; padding:24px}

/* ==== Overlay base ==== */
.overlay{position:fixed; inset:0; background:rgba(0,0,0,.55); backdrop-filter:blur(6px); display:grid; place-items:center; z-index:20}
.overlay.hidden{display:none !important}

/* ==== Playlist modal ==== */
.pl-card{width:min(92vw,720px); background:var(--glass); border-radius:16px; padding:16px; backdrop-filter:blur(14px) saturate(150%)}
.pl-top{display:flex; align-items:center; justify-content:space-between}
.gap8{display:flex; gap:8px}

/* ==== Puzzle ==== */
/* Topbar: una riga, centrata, autoscale */
.pz-topbar{
  position: fixed;
  top: max(10px, env(safe-area-inset-top, 0px));
  left: 50%;
  transform: translateX(-50%) scale(var(--pz-scale, 1));
  transform-origin: top center;
  z-index: 50;

  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  flex-wrap: nowrap;
  white-space: nowrap;

  padding: 6px 8px;
  border-radius: 14px;
  backdrop-filter: blur(10px) saturate(140%);
  background: linear-gradient(180deg, rgba(10,15,20,.78), rgba(10,15,20,.45));
  color:#fff;
  text-shadow: 0 1px 2px rgba(0,0,0,.35);
}
.pz-topbar .chip{
  background:rgba(255,255,255,.12);
  padding:6px 10px;
  border-radius:999px;
  box-shadow:0 6px 20px #0006;
  display:inline-flex; align-items:center; gap:6px; font-weight:700;
}
.pz-diff .lbl{ opacity:.9; margin-right:2px; }
.pz-topbar .chip-btn{
  background:#222c33; color:#fff; border:0;
  padding:4px 10px; border-radius:999px; margin-left:4px; cursor:pointer; font-weight:800;
}
.pz-topbar .chip-btn.active{background:#ff8a00}

/* Stage: lascia spazio alla topbar */
.pz-stage{
  display:grid; place-items:center;
  min-height:60vh;
  padding-top: calc(var(--pz-topbar-h) + 22px);
  padding-bottom: clamp(150px, 28vh, 240px);
}

.pz-img-wrap{position:relative; width:min(90vw,820px); aspect-ratio:4/3}
.pz-img-wrap img#pzImg{position:absolute; inset:0; width:100%; height:100%; object-fit:contain; z-index:1}
#pzGrid{position:absolute; inset:0; z-index:2; display:grid; gap:2px}

/* tasselli */
.pz-tile{
  background: rgba(10, 15, 20, 0.97);
  border-radius: 12px;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.10), 0 2px 8px rgba(0,0,0,.35);
  will-change: transform, opacity;
  opacity: 1;
}
.pz-tile.cleared{ visibility: hidden; pointer-events: none; }

/* puff */
.puff{
  position:absolute; width:120px; height:120px; left:0; top:0;
  transform: translate(-50%, -50%); pointer-events:none;
  background: radial-gradient(circle at 50% 50%,
    rgba(255,255,255,.85) 0%,
    rgba(255,210,130,.45) 40%,
    rgba(255,170,60,.22) 65%,
    rgba(0,0,0,0) 70%);
  filter: blur(2px);
  animation: puff 600ms ease-out forwards;
}
@keyframes puff{
  0%   { transform: translate(-50%,-50%) scale(.6); opacity:.95; }
  100% { transform: translate(-50%,-50%) scale(2.2); opacity:0; }
}

/* animazioni tassello */
.pz-tile.hit{ animation: tileFlip .6s ease both, tileFlash .25s ease-in .05s both; }
@keyframes tileFlip{
  0%   { transform: rotateY(0deg);   opacity:1; }
  50%  { transform: rotateY(360deg); opacity:.85; }
  100% { transform: rotateY(720deg); opacity:0;   }
}
@keyframes tileFlash{ 0%{box-shadow:0 0 0 rgba(255,255,255,0);} 100%{box-shadow:0 0 24px rgba(255,255,255,.6);} }

/* QA in basso */
.qa-card{
  position:fixed; left:50%; bottom:16px; transform:translateX(-50%);
  width:min(96vw,980px);
  background:url('./assets/images/wood.png') center/cover;
  border-radius:16px;
  padding:14px;
  color:#fff; z-index:25; box-shadow:0 18px 60px #0008;
}
.qa-title{font-weight:900; margin:4px 6px 10px}

/* Risposte: stile iOS Liquid Glass */
.qa-answers{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}
.qa-answers .btn{
  -webkit-backdrop-filter: blur(14px) saturate(160%);
  backdrop-filter: blur(14px) saturate(160%);
  background: var(--lg-bg);
  color: #fff;
  border-radius: 14px;
  border: 1px solid var(--lg-border);
  box-shadow:
    inset 0 1px 0 var(--lg-inner),
    var(--lg-shadow);
  padding: 12px 14px;
  font-weight: 800;
  letter-spacing: .15px;
  transition: transform .08s ease, background .15s ease, box-shadow .15s ease, filter .15s ease;
  cursor: pointer;
  text-align: center;
  user-select: none;
}
.qa-answers .btn:hover{
  background: var(--lg-bg-strong);
  box-shadow:
    inset 0 1px 0 var(--lg-inner),
    0 12px 42px rgba(0,0,0,.34);
}
.qa-answers .btn:active{
  transform: translateY(1px) scale(.98);
  filter: saturate(1.1);
}
.qa-answers .btn:focus-visible{
  outline: 2px solid rgba(255,255,255,.45);
  outline-offset: 2px;
  box-shadow:
    0 0 0 4px rgba(255,255,255,.12),
    var(--lg-shadow);
}

/* bravo / no-img */
.bravo{
  position:fixed; inset:0; display:grid; place-items:center; z-index:26;
  background:rgba(0,0,0,.35); backdrop-filter:blur(4px);
  color:#fff; font-weight:900; font-size:clamp(22px,5vw,44px);
}
.no-img{
  position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
  width:min(42vw, 300px); height:auto; z-index: 3; pointer-events:none;
}
.shake{ animation:shake .7s ease; }
@keyframes shake{
  10%, 90% { transform: translate(-50%,-50%) translateX(-1px); }
  20%, 80% { transform: translate(-50%,-50%) translateX(2px); }
  30%, 50%, 70% { transform: translate(-50%,-50%) translateX(-4px); }
  40%, 60% { transform: translate(-50%,-50%) translateX(4px); }
}

/* ==== piccoli ritocchi responsive ==== */
@media (max-width: 560px){
  .qa-answers{ grid-template-columns:1fr; }
  :root{ --pz-topbar-h: 62px; }
  .pz-topbar{ gap:6px; padding:5px 6px; }
  .pz-topbar .chip{ padding:5px 9px; }
  .qa-card{ width:min(96vw, 680px); }
}
